<?xml version="1.0" encoding="utf-8"?>
<s:Panel xmlns:fx="http://ns.adobe.com/mxml/2009"
		 xmlns:s="library://ns.adobe.com/flex/spark"
		 xmlns:mx="library://ns.adobe.com/flex/mx"
		 xmlns:parsley="http://www.spicefactory.org/parsley"
		 xmlns:components="org.larse.components.*"
		 mouseEnabled="true"
		 title="Spectral Trajectory"
		 creationComplete="initGraph(event)"
		 width="100" height="100" >
	<fx:Declarations>
		<parsley:Configure/>
	</fx:Declarations>

	<fx:Script>
		<![CDATA[
			import mx.collections.ArrayCollection;
			import mx.events.FlexEvent;

			private var wetness:TrajectoryChart;
			private var angle:TrajectoryChart;
			private var nbr:TrajectoryChart;
			private var ndvi:TrajectoryChart;
			private var brightness:TrajectoryChart;

			public function setPlotSpectrals(plotSpectrals:ArrayCollection):void {
				wetness.spectralIndex = "wetness";
				wetness.plotSpectrals = plotSpectrals;

				angle.spectralIndex = "angle";
				angle.plotSpectrals = plotSpectrals;

				nbr.spectralIndex = "nbr";
				nbr.plotSpectrals = plotSpectrals;

				ndvi.spectralIndex = "ndvi";
				ndvi.plotSpectrals = plotSpectrals;

				brightness.spectralIndex = "brightness";
				brightness.plotSpectrals = plotSpectrals;
				resetScale2();
			}

			protected function initGraph(event:FlexEvent):void
			{
				wetness = new TrajectoryChart();
				wetness.percentHeight=100;
				wetness.percentWidth=100;
				wetnessbox.addChild(wetness);

				angle = new TrajectoryChart();
				angle.percentHeight=100;
				angle.percentWidth=100;
				anglebox.addChild(angle);

				nbr = new TrajectoryChart();
				nbr.percentHeight=100;
				nbr.percentWidth=100;
				nbrbox.addChild(nbr);

				ndvi = new TrajectoryChart();
				ndvi.percentHeight=100;
				ndvi.percentWidth=100;
				ndvibox.addChild(ndvi);

				brightness = new TrajectoryChart();
				brightness.percentHeight=100;
				brightness.percentWidth=100;
				brightnessbox.addChild(brightness);

				initMenu();
			}

			protected function initMenu():void
			{
				var autoMenu:ContextMenuItem = new ContextMenuItem("Plot Stretch");
				autoMenu.addEventListener(ContextMenuEvent.MENU_ITEM_SELECT, resetScale_Handler);

				var resetMenu:ContextMenuItem = new ContextMenuItem("Global Stretch");
				resetMenu.addEventListener(ContextMenuEvent.MENU_ITEM_SELECT, resetScale_Handler);

				var menu:ContextMenu = new ContextMenu();
				menu.hideBuiltInItems();
				menu.customItems.push(resetMenu);
				menu.customItems.push(autoMenu);
				menu.hideBuiltInItems();

				this.contextMenu = menu;
			}

			public function resetScale_Handler(event:ContextMenuEvent):void
			{
				trace("Reset scale");
				var m:ContextMenuItem = event.target as ContextMenuItem;
				switch (tabnav.selectedIndex) {
					case 0:
						wetness.resetScale_Handler(m.caption);
						break;
					case 1:
						angle.resetScale_Handler(m.caption);
						break;
					case 2:
						nbr.resetScale_Handler(m.caption);
						break;
					case 3:
						ndvi.resetScale_Handler(m.caption);
						break;
					case 4:
						brightness.resetScale_Handler(m.caption);
						break;
				}
			}

			public function resetScale():void {
				wetness.resetScale_Handler("Global Stretch");
				angle.resetScale_Handler("Global Stretch");
				nbr.resetScale_Handler("Global Stretch");
				ndvi.resetScale_Handler("Global Stretch");
				brightness.resetScale_Handler("Global Stretch");
			}

			public function resetScale2():void {
				wetness.resetScale_Handler("Plot Stretch");
				angle.resetScale_Handler("Plot Stretch");
				nbr.resetScale_Handler("Plot Stretch");
				ndvi.resetScale_Handler("Plot Stretch");
				brightness.resetScale_Handler("Plot Stretch");
			}

		]]>
	</fx:Script>


	<mx:TabNavigator id="tabnav" width="100%" height="100%">
		<mx:VBox id="wetnessbox" width="100%" height="100%" label="Wetness"/>
		<mx:VBox id="anglebox" width="100%" height="100%" label="Angle"/>
		<mx:VBox id="nbrbox" width="100%" height="100%" label="NBR"/>
		<mx:VBox id="ndvibox" width="100%" height="100%" label="NDVI"/>
		<mx:VBox id="brightnessbox" width="100%" height="100%" label="Brightness"/>
	</mx:TabNavigator>
</s:Panel>
